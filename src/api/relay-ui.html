<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>RTMP Delay Relay - Control Panel</title>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<style>
			body {
				font-family: sans-serif;
				margin: 1em;
				background: #fff;
				color: #222;
			}
			form {
				margin-bottom: 1.5em;
			}
			label {
				display: inline-block;
				width: 180px;
				font-weight: 600;
			}
			input[type='number'],
			input[type='text'] {
				width: 120px;
			}
			button {
				margin-left: 10px;
				background: #e0e0e0;
				color: #222;
				border: 1px solid #bbb;
				border-radius: 4px;
				padding: 0.4em 1.2em;
				cursor: pointer;
				transition: background 0.2s, color 0.2s, border 0.2s;
			}
			button:hover,
			button:focus {
				background: #b3d1ff;
				color: #111;
				border: 1.5px solid #3399ff;
				outline: none;
			}
			.row {
				margin-bottom: 0.5em;
			}
			#result {
				background: #f4f4f4;
				color: #222;
				padding: 1em;
				margin-top: 1em;
				border-radius: 4px;
			}

			body.dark-mode {
				background: #181a1b !important;
				color: #e0e0e0 !important;
			}
			body.dark-mode #result {
				background: #23272e !important;
				color: #e0e0e0 !important;
			}
			body.dark-mode input,
			body.dark-mode button,
			body.dark-mode select {
				background: #23272e !important;
				color: #e0e0e0 !important;
				border: 2px solid #444 !important;
			}
			body.dark-mode button:hover,
			body.dark-mode button:focus {
				background: #2d3a4a !important;
				color: #fff !important;
				border: 2px solid #3399ff !important;
				outline: none;
			}
		</style>
		<script>
			function apiCall(path) {
				fetch(path)
					.then(resp => {
						const contentType = resp.headers.get('content-type') || '';
						if (contentType.includes('application/json')) {
							return resp.json().then(data => ({ type: 'json', data }));
						} else {
							return resp.text().then(data => ({ type: 'text', data }));
						}
					})
					.then(result => {
						if (result.type === 'json') {
							document.getElementById('result').textContent = JSON.stringify(result.data, null, 2);
						} else {
							document.getElementById('result').textContent = result.data;
						}
					})
					.catch(err => {
						document.getElementById('result').textContent = 'Error: ' + err;
					});
			}
			function submitForm(event, path, param) {
				event.preventDefault();
				var val = event.target.elements[param].value;
				var url = path + '?' + param + '=' + encodeURIComponent(val);
				apiCall(url);
			}
			function toggleDarkMode() {
				document.body.classList.toggle('dark-mode');
				localStorage.setItem('relay-ui-dark', document.body.classList.contains('dark-mode'));
			}
			window.addEventListener('DOMContentLoaded', () => {
				let darkMode = localStorage.getItem('relay-ui-dark');
				// Check if dark mode got saved to localStorage
				// if not load the system preference
				const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
				if (darkMode === null) {
					darkMode = prefersDarkScheme.matches ? 'true' : 'false';
				}
				if (darkMode === 'true') {
					document.body.classList.add('dark-mode');
				}
			});
		</script>
	</head>
	<body>
		<button style="float: right; margin-bottom: 1em" onclick="toggleDarkMode()">Toggle Dark Mode</button>
		<form onsubmit="submitForm(event, '/set-local-port', 'port')">
			<div class="row"><label>Local Port:</label><input name="port" type="number" min="1" max="65535" required placeholder="e.g. 8888" /><button type="submit">Set</button></div>
		</form>
		<form onsubmit="submitForm(event, '/set-delay', 'ms')">
			<div class="row"><label>Stream Delay (ms):</label><input name="ms" type="number" min="1" required placeholder="e.g. 10000" /><button type="submit">Set</button></div>
		</form>
		<form onsubmit="submitForm(event, '/set-remote-url', 'url')">
			<div class="row"><label>Remote RTMP URL:</label><input name="url" type="text" required placeholder="e.g. live.twitch.tv" /><button type="submit">Set</button></div>
		</form>
		<form onsubmit="submitForm(event, '/set-rtmp-port', 'port')">
			<div class="row"><label>Remote RTMP Port:</label><input name="port" type="number" min="1" max="65535" required placeholder="e.g. 1935" /><button type="submit">Set</button></div>
		</form>
		<form onsubmit="submitForm(event, '/set-latency', 'ms')">
			<div class="row"><label>Latency Interval (ms):</label><input name="ms" type="number" min="1" required placeholder="e.g. 10" /><button type="submit">Set</button></div>
		</form>
		<form onsubmit="submitForm(event, '/set-max-chunks', 'chunks')">
			<div class="row"><label>Max Buffer Chunks:</label><input name="chunks" type="number" min="1" required placeholder="e.g. 10000" /><button type="submit">Set</button></div>
		</form>
		<form onsubmit="submitForm(event, '/set-max-bytes', 'bytes')">
			<div class="row"><label>Max Buffer Bytes:</label><input name="bytes" type="number" min="1" required placeholder="e.g. 52428800" /><button type="submit">Set</button></div>
		</form>
		<div class="row">
			<button onclick="apiCall('/activate-delay')">Activate Delay</button>
			<button onclick="apiCall('/deactivate-delay')">Deactivate Delay</button>
			<button onclick="apiCall('/status')">Show Status</button>
		</div>
		<pre id="result"></pre>
	</body>
</html>
